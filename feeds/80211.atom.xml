<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Gioacchino's Radio Shack - 802.11</title><link href="https://castogio.github.io/" rel="alternate"></link><link href="https://castogio.github.io/feeds/80211.atom.xml" rel="self"></link><id>https://castogio.github.io/</id><updated>2023-05-08T00:01:00+01:00</updated><entry><title>Channel Switch Announcements explained</title><link href="https://castogio.github.io/channel-switch-announcements-explained.html" rel="alternate"></link><published>2023-05-08T00:01:00+01:00</published><updated>2023-05-08T00:01:00+01:00</updated><author><name>Gioacchino Castorio</name></author><id>tag:castogio.github.io,2023-05-08:/channel-switch-announcements-explained.html</id><summary type="html">&lt;p&gt;In this article, I would like to describe what I believe is an interesting 
mechanic of dot11 wireless networks called &lt;em&gt;Channel Switch Announcement&lt;/em&gt; (CSA). 
This is often overlooked as it usually works pretty much flawlessly, but it is
pretty much ubiquitous in today's deployments because admins
use automatic Resource Radio …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In this article, I would like to describe what I believe is an interesting 
mechanic of dot11 wireless networks called &lt;em&gt;Channel Switch Announcement&lt;/em&gt; (CSA). 
This is often overlooked as it usually works pretty much flawlessly, but it is
pretty much ubiquitous in today's deployments because admins
use automatic Resource Radio Management (RRM), which may prompt for 
(frequent) channel changes on the Access Points as they adapt to the surrounding
RF environment. CSAs are also used whenever a Dynamic Frequency Selection (DFS)
occurs in the 5 GHz band, and the AP must move to a non-radar channel.&lt;/p&gt;
&lt;p&gt;The primary goal of CSAs is to allow the AP to change its channel, while keeping
the clients associated. Of course, the clients have to follow the AP along with 
the change, and start transmitting on the new channel (they may actually decide
to simply disassociate).&lt;/p&gt;
&lt;p&gt;We will explore together the CSA procedures and the Information Element (IE) 
formats as defined in the IEEE802.11-2020 standard, and confirm the behaviours
in two Case Studies for DFS-triggered and RRM-triggered channel switches.
Please note that this blog post specifically describes the case of APs in a 
Basic Service Set (BSS).&lt;/p&gt;
&lt;h2&gt;How channel wwitches are announced&lt;/h2&gt;
&lt;p&gt;First, we need to clarify where the AP puts Channel Switch Announcements. 
These CSAs are carried by the &lt;em&gt;CSA Information Element&lt;/em&gt; (IE) and the &lt;em&gt;Extended&lt;/em&gt;
&lt;em&gt;CSA IE&lt;/em&gt; in the following types of frames right before the change is operated:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Beacon Management Frames&lt;/strong&gt; (Wireshark filter: wlan.fc.type_subtype == 8).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Probe Responses&lt;/strong&gt; (Wireshark filter: wlan.fc.type_subtype == 5).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spectrum Management Action Frames&lt;/strong&gt; (Wireshark filter: wlan.fc.type_subtype == 13).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can see an exhibit from Wireshark showing a sequence of Beacon frames and
an Action frame before a channel switch from Ch 112 to Ch 48.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="CSAs frames in Wireshark" src="https://castogio.github.io/images/csa_explained/wireshark_list_frames.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;All these frames are &lt;em&gt;broadcast&lt;/em&gt; and they carry information regarding what the
&lt;em&gt;new channel&lt;/em&gt; will be, and they state how much time is left before the switch, 
expressed as a multiplicative factor of the 
TBTT (Target Beacon Transmission Time). 
I made sure the picture shows them  in a human-friendly format by re-naming the 
columns, but we will deep dive into the details of the IE in the next sections.&lt;/p&gt;
&lt;h2&gt;CSA Information Element format&lt;/h2&gt;
&lt;p&gt;When it comes to Information Elements, the best place where to find clear
information is the standard paper itself, so this section takes heavily from
&lt;strong&gt;IEEE 802.11-2020 Section 9.4.2.18&lt;/strong&gt;. The following figure shows the Channel
Switch Announcement IE format as defined in the standard to "advertise when [an 
AP] is changing to a new channel and the channel number of the new channel."
 This IE was introduced in the IEEE 802.11h amendment.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="CSA element format" src="https://castogio.github.io/images/csa_explained/csa_ie_format.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The following fields are defined:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;em&gt;Element ID&lt;/em&gt; (1 byte) is 37.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;Channel Switch Mode&lt;/em&gt; Field (1 byte) can assume the value &lt;em&gt;0&lt;/em&gt; when the 
  client stations and the AP itself can continue exchanging frames before the
  channel switch happens. If the value is &lt;em&gt;1&lt;/em&gt;, no more frames should be
  exchanged before the switch.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;New Channel Number&lt;/em&gt; field (1 byte) is the channel that will be used
  by the AP after the switch (you could call it the "new channel").&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;Channel Switch Count&lt;/em&gt; field (1 byte) is tricky as it states how much
  time will elapse before the channel change, and it is expressed in multiples 
  of the TBTT, which is the target amount of time between a Beacon Frame and the 
  following one for the same BSS (assuming the medium is available). A TBTT is 
  composed of 100 Time Units (TUs), which in turn is 1024 
  microseconds. The Channel Switch Count value &lt;em&gt;1&lt;/em&gt; means that the AP will
  broadcast the next Beacon frame and continue operating in the new channel.
  Value &lt;em&gt;0&lt;/em&gt; indicates that the actual switch will happen &lt;em&gt;at any time&lt;/em&gt; after the 
  current frame is broadcasted (i.e. the clients may want to switch immediately
  to be prepared).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Extended CSA Information Element format&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;IEEE 802.11-2020 Section 9.4.2.52&lt;/strong&gt; defines the Extended Channel Switch
Announcement IE (E-CSA IE), which specifies if the "BSS is changing to a new 
channel in the same or a new operating class." This IE was first introduced in 
the IEEE 802.11y amendment to replace the CSA IE. The latter is still 
broadcasted for backward compatibility.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="Extended CSA element format" src="https://castogio.github.io/images/csa_explained/extended_csa_ie.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;This IE carries almost the same information as the CSA IE, so we will focus on 
a subset of them, which are particularly interesting and justify the existence 
of the Extended CSA element:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;em&gt;Element ID&lt;/em&gt; (1 byte) is 37.&lt;/li&gt;
&lt;li&gt;The &lt;em&gt;New Operating Class&lt;/em&gt; (1 byte) field specifies the new operating class
  after the channel switch happens. The values for classes are defined in 
  "Annex E" of the standard, they depend on the Regulatory Domain as specified 
  in the Country Element (Section 9.4.2.8), and they indicate the frequency of 
  the channel, the channel centre frequency, the maximum channel width, and 
  other behavioural constraints.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Case Study: DFS-triggered channel changes&lt;/h2&gt;
&lt;p&gt;The standard is quite dry, so I recreated the conditions of a channel switch by 
simulating a DFS event in my lab network to observe what values populated the 
fields we described in the previous sections.&lt;/p&gt;
&lt;p&gt;My AP was operating on channel 112, which falls in the 
Unlicensed National Information Infrastructure 2 Extended (U-NII-2e) range, and 
it might be affected by DFS events. These events can be caused by radars or any
other RF radiator mimicking radar. If an event is detected the AP must inform
the clients that they have to stop transmitting and move to a different channel,
usually referred to as a "mute" or "fallback" channel. The AP
and the clients have 10 seconds to leave the DFS channel.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="Captured CSA IE values for DFS" src="https://castogio.github.io/images/csa_explained/channel_switch_announcement_information_element.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;As you can see in the figure above, the CSA IE states that the new channel is 
48 (a non-DFS channel in the U-NII-1 range), the switch will happen in 5 TBTTs,
and the &lt;em&gt;clients should not transmit any more frames over the current channel&lt;/em&gt;.
The latter command is unsurprising, and it perfectly aligns with the 
DFS requirement.&lt;/p&gt;
&lt;p&gt;The AP can send one or more CSA frames in the form of Beacons, Probe Responses 
and Action Frames to make sure that all its clients move and keep 
their association status.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="CapturedExtended CSA IE for DFS" src="https://castogio.github.io/images/csa_explained/extended_channel_switch_announcement_information_element.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The E-CSA field is contained in the same frames and it carries similar 
information with the addition of the "New Operating Class" equal to 0x01 
(hexadecimal). In Europe where I live, class 1 means that the new channel 
belongs a group composed of Channels 36, 40, 44, and 48 (i.e U-NII-1), the 
starting frequency for the group is 5 GHz, their channel spacing is 20 MHz, and
there are no additional behaviour limits (refer to Table E-2 from the standard).&lt;/p&gt;
&lt;h2&gt;Case Study: RRM-triggered channel changes&lt;/h2&gt;
&lt;p&gt;Channel changes due to automatic RRM are another very interesting case study,
probably more relevant than the DFS one, as RRM can kick in very frequently 
when the RF environment is particularly harsh (e.g. high channel utilisation).&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="Captured CSA for RRM Channel Change" src="https://castogio.github.io/images/csa_explained/csa_channel_change.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The figure above shows both the CSA and E-CSA IEs when the channel is about to 
switch to 161. The new operating class is 0x11 (hex for 17), which in Europe 
refers to the channel set containing 149, 153, 157, 161, 165, and 169 (also
known as U-NII-3).
Furthermore, note that the Channel Switch Mode is set to 0 so the 
clients and the AP may keep exchanging frames until the channel switch, hence 
virtually nullifying (or minimising as much as possible) any service 
interruptions during RRM channel switches.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;IEEE 802.11-2020: Wireless LAN Medium Access Control (MAC) and Physical Layer 
  (PHY) Specifications (2020 revision), IEEE-SA, 2021&lt;/li&gt;
&lt;li&gt;Coleman, David D., and David A. Westcott. CWNA Certified Wireless Network 
  Administrator Study Guide: Exam CWNA-107. John Wiley &amp;amp; Sons, 2018.&lt;/li&gt;
&lt;/ul&gt;</content><category term="802.11"></category></entry><entry><title>Introduction to RX-SOP Configuration</title><link href="https://castogio.github.io/introduction-to-rx-sop-configuration.html" rel="alternate"></link><published>2023-05-01T12:00:00+01:00</published><updated>2023-05-01T12:00:00+01:00</updated><author><name>Gioacchino Castorio</name></author><id>tag:castogio.github.io,2023-05-01:/introduction-to-rx-sop-configuration.html</id><summary type="html">&lt;p&gt;Cisco Receiver Start of Packet Detection Threshold (RX-SOP) is 
a feature available on a multitude of enterprise access points, but experience 
taught me it is often misunderstood by junior wireless engineers.&lt;/p&gt;
&lt;p&gt;In a sentence, the RX-SOP configuration declares the Wi-Fi power required for an 
access point to pick up signals …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Cisco Receiver Start of Packet Detection Threshold (RX-SOP) is 
a feature available on a multitude of enterprise access points, but experience 
taught me it is often misunderstood by junior wireless engineers.&lt;/p&gt;
&lt;p&gt;In a sentence, the RX-SOP configuration declares the Wi-Fi power required for an 
access point to pick up signals, demodulation and then start decoding the 
physical layer protocol data unit (PPDU). 
This definition begs the question: why is such a feature required?
I believe that having a clear picture of how signal decay 
over distance is necessary to understand the implications of RX-SOP.
​&lt;/p&gt;
&lt;h2&gt;RF propagation refresher&lt;/h2&gt;
&lt;p&gt;​
We call an "isotropic radiator" an intentional radiator (IR) with no spatial 
dimensions (i.e. a dot) in the infinite void, emitting a wave
signal of amplitude P(tx) in all directions. This entity is, of course, ideal 
and it cannot be implemented in real life., but it will help us describe
the behaviour of radiation moving through space. &lt;/p&gt;
&lt;!-- The power emitted is maximum at the IR and equal to P(tx).  --&gt;
&lt;p&gt;A receiver at distance &lt;em&gt;d&lt;/em&gt; for the IR would see a different power level 
&lt;em&gt;strictly less&lt;/em&gt; than P(tx), as the transmitted amount spreads 
to all directions; we can name the received power P(rx).
In the case of an isotropic IR, we can easily compute P(rx)
as the power spreads over a spherical wavefront.
The &lt;em&gt;power density I&lt;/em&gt; at distance &lt;em&gt;d&lt;/em&gt; on a punctiform section of the sphere
is defined as follows:
​&lt;/p&gt;
&lt;!-- I = \frac{P_{tx}}{2\pi d^{2}} --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="transmit power density formula" src="https://castogio.github.io/images/rxsop_intro/power_density_formula.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;In other words, the value "I" represents how the transmitted power distributes 
in a point at distance &lt;em&gt;d&lt;/em&gt; from the IR. It also lets us compute how much power 
P(rx) can be captured by a punctiform section of the receiving antenna. &lt;/p&gt;
&lt;p&gt;Multiplying &lt;em&gt;I&lt;/em&gt; by the &lt;em&gt;effective area&lt;/em&gt; of the antenna will
give us the total received power. The effective area depends on the directivity 
of the receiving antenna in general. However, when the receiver is far away from 
the transmitter (at least two or three times the wavelength &lt;em&gt;lambda&lt;/em&gt;), it can be 
&lt;a href="https://bit.ly/40WJMdj"&gt;proven&lt;/a&gt; that:
​&lt;/p&gt;
&lt;!-- P_{rx} = I A_{eff} = \frac{P_{tx}}{2\pi d^2}A_{eff} = 
    P_{tx} (\frac{\lambda}{2 \pi d})^2  = FSPL(d) * P_{tx}
--&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="received power formula" src="https://castogio.github.io/images/rxsop_intro/received_power_formula.png"&gt;
&lt;/center&gt;
​
As you can see from the above, the distance &lt;em&gt;d&lt;/em&gt; contributes significantly to
the power loss in ideal conditions. We call this effect the Free 
Space Path Loss (FSPL). At a distance of 1 m from the IR, regardless of the
transmitted power, P(rx) is approximately 40%
less than the transmitted power. The figure below shows the decay of the 
received power for varying values of the distance &lt;em&gt;d&lt;/em&gt; when the transmit power 
P(tx) = 30 dBm and the lambda = 6 cm (frequency = 5 GHz) are set:&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="rx power delay FSPL" src="https://castogio.github.io/images/rxsop_intro/fspl_grapth.png"&gt;
&lt;/center&gt;
​
What we described superimposes to other detrimental effects, 
(such as material absorption) which are effectively multiplicative factors in 
the formula for P(rx) and it makes the curve decay faster.&lt;/p&gt;
&lt;p&gt;​&lt;/p&gt;
&lt;h2&gt;RX-SOP operations&lt;/h2&gt;
&lt;p&gt;​
Having a clearer picture of the harshness of the RF environment, the receiver 
needs to detect between actual signals, which intensity may be comparable to a 
whisper in a noisy environment. This is when RX-SOP comes into play.&lt;/p&gt;
&lt;p&gt;There is a power level called "sensitivity," which is the signal strength 
(expressed in dBm) of the weakest signal that the AP can distinguish from 
the background noise and process successfully.
RX-SOP does not alter the sensitivity of your access point. On the other hand, 
changing the RX-SOP level forces the AP to &lt;em&gt;actively ignore&lt;/em&gt; signals below a 
certain power in dBm. For instance, Cisco Meraki APs use -95 dBm by default when
enabled on the Dashboard.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
&lt;img alt="meraki rx-sop default" src="https://castogio.github.io/images/rxsop_intro/meraki_rx_sop_default.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The described concept may sound familiar to those of you who are amateur radio
operators as this is a form of 
"&lt;a href="https://en.wikipedia.org/wiki/Squelch"&gt;carrier squelch&lt;/a&gt;", 
i.e. suppressing the receiver output if the input signal is not strong enough. 
You can see the effects of RX-SOP muting when the level is set to -70 dBm:
​&lt;/p&gt;
&lt;!-- SEQUENCE DIAGRAM
    @startuml
    Client -[#green]&gt; AP: frame received at -60 dBm (&gt; -70 dBm)
    AP -[#green]&gt; AP: PROCESSED
    Client -[#green]&gt; AP: signal -50 dBm (&gt; -70 dBm)
    AP -[#green]&gt; AP: PROCESSED
    Client -[#red]&gt; AP: signal -75 dBm (&lt; -70 dBm)
    Client -[#red]&gt; AP: signal -71 dBm (&lt; -70 dBm)
    Client -[#red]&gt; AP: signal -80 dBm (&lt; -70 dBm)
    @enduml
--&gt;

&lt;p&gt;&lt;center&gt;
    &lt;img alt="RX-SOP operatiomns" src="https://castogio.github.io/images/rxsop_intro/rx_sop_operation.png"&gt;
&lt;/center&gt;
​
Quoting from Cisco, this feature is "ideal for high-density environments [...]
where there are a large number of client devices connected per AP [... where
...] the smaller the cell size, the better."
​
The benefit might come from the fact that the AP will not reset its 
Network Allocation Vector (NAV) timer when receiving a signal below the 
threshold so that it can start transmitting relatively more frequently.
​
I saw this configuration altered in the wild by inexperienced administrators and 
troubleshooters without properly validating its effect on the environment,
especially to address the issue of sticky clients. The latter is not advisable:
the RX-SOP is a receive-only configuration and it applies &lt;strong&gt;only&lt;/strong&gt; to the AP
side, while the client will continue receiving transmissions from the AP
as if nothing changed. The client may send a frame using its estimated 
"correct" power level for the AP to receive, while the AP ignores
the frame as the received signal strength is not above the set threshold. This
behaviour may lead to excessive retransmissions and client disconnections in
the worst scenarios, especially at the boundary of the cell coverage where the
asymmetry may be felt the most.
A better result in reducing &lt;em&gt;bidirectionally&lt;/em&gt; the cell size
could have been accomplished by simply reducing the AP transmit power, while 
guaranteeing appropriate primary and secondary coverage.
​&lt;/p&gt;
&lt;h2&gt;Final remarks&lt;/h2&gt;
&lt;p&gt;​
Altering the default value of RX-SOP is a risky matter leading to unexpected 
behaviours and interruption of the wireless service if you do not know what
you are trying to accomplish and you do not have a clear picture of the 
mathematics behind signal propagation. 
In general, RX-SOP should not be used without following a well-thought design, 
followed by validation and tuning after the deployment in high-density 
environments with many clients (e.g. auditoriums, stadiums). &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tl;dr&lt;/strong&gt; -- never shoot off the hip when using RX-SOP, do your
homework with the design, and consider first decreasing power to reduce cell
sizes instead.
​
​
​&lt;/p&gt;
&lt;h3&gt;Bibliography&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;"High Density Experience (HDX) Deployment Guide, Release 8.0." Cisco, 
   Jun. 2015, https://bit.ly/3oTelUe. Accessed 30 Apr. 2023.&lt;/li&gt;
&lt;li&gt;"Free-space Path Loss." Scholarly Community Encyclopedia, 
   Oct. 2022, https://bit.ly/40WJMdj. Accessed 30 Apr. 2023.&lt;/li&gt;
&lt;li&gt;"Receive Start of Packet (RX-SOP)." Cisco Meraki, 
   Oct. 2020, https://bit.ly/41R9xxa. Accessed 30 Apr. 2023.&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- https://encyclopedia.pub/entry/31362#:~:text=The%20free%2Dspace%20path%20loss%20(FSPL)%20formula%20derives%20from,%CE%BB%204%20%CF%80%20d%20)%202 --&gt;
&lt;!-- https://www.cisco.com/c/en/us/td/docs/wireless/controller/technotes/8-0/hdx_final/b_hdx_dg_final/high_density_experience_features_added_in_release_8_0.html --&gt;
&lt;!--
https://documentation.meraki.com/MR/Radio_Settings/Receive_Start_of_Packet_(RX-SOP)
--&gt;
&lt;p&gt;​&lt;/p&gt;</content><category term="802.11"></category></entry><entry><title>Troubleshooting WPA2-Enterprise with Meraki Cloud Authentication</title><link href="https://castogio.github.io/troubleshooting-wpa2-enterprise-with-meraki-cloud-authentication.html" rel="alternate"></link><published>2023-04-26T23:00:00+01:00</published><updated>2023-04-26T23:00:00+01:00</updated><author><name>Gioacchino Castorio</name></author><id>tag:castogio.github.io,2023-04-26:/troubleshooting-wpa2-enterprise-with-meraki-cloud-authentication.html</id><summary type="html">&lt;!-- write an introduction --&gt;
&lt;p&gt;I was tinkering in my lab with my very old MacBook, now running Windows 10, 
a few days ago, looking for ways to simplify my troubleshooting activities at work.
There is a service that the Cisco Meraki access points offer, called Meraki 
Cloud Authentication, which offers an authentication server for …&lt;/p&gt;</summary><content type="html">&lt;!-- write an introduction --&gt;
&lt;p&gt;I was tinkering in my lab with my very old MacBook, now running Windows 10, 
a few days ago, looking for ways to simplify my troubleshooting activities at work.
There is a service that the Cisco Meraki access points offer, called Meraki 
Cloud Authentication, which offers an authentication server for 802.1X running
24/7 on their server. This uses the EAP-PEAP/EAP-TLS method to authenticate
users who provide an email username and a password. &lt;/p&gt;
&lt;p&gt;The email requested by the server is case-sensitive. Unsurprisingly an easy way 
to fail authentication is simply to write the correct email with one or more 
characters in the wrong case. Another common L8 issue is, of course, typing the
wrong password because the user forgot it.&lt;/p&gt;
&lt;p&gt;In this blog post, I would like to present some useful tips to troubleshoot
incorrect authentication credentials using the Event Viewer in Windows 10.
This tool ships natively with the OS and it provides a step-by-step report of
what is happening when connecting to an SSID, as it allows monitoring 
the service called "&lt;em&gt;WLAN-AutoConfig&lt;/em&gt;," in charge of the 802.11 state machine.&lt;/p&gt;
&lt;h2&gt;Accessing the Event Viewer&lt;/h2&gt;
&lt;p&gt;Let's start by accessing the logs. This is easily done by opening
the Start menu and searching for "Event Viewer." 
You can now navigate as follows in the menu on the left (each section is a 
dropdown item you can unfold):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Applications and Service Logs  &amp;gt; Microsoft &amp;gt; Windows &amp;gt; WLAN-AutoConfig.&lt;/li&gt;
&lt;li&gt;Click on the WLAN-Autoconfig item.&lt;/li&gt;
&lt;li&gt;Right-click on the "Operational" logs and make sure the log is enabled.
   (you will see the button "Disable Log").&lt;/li&gt;
&lt;li&gt;Right-click on the "Operational" logs to make sure you opened the logs.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Most likely, you will see a list of events in the centre frame of the Event
Viewer; this is normal, and these logs refer to previous operations executed 
by your wireless network card.&lt;/p&gt;
&lt;h2&gt;Dissecting a successful authentication&lt;/h2&gt;
&lt;p&gt;From the perspective of the Client station, there is no difference between a 
server located on-premises or in the cloud. Referring to the sequence diagram
shown below,
the administrator will notice a negligible deviation from what they may expect 
from standard 802.1X authentication processes; however, the actual RADIUS
exchanges are tunnelled between the Meraki APs (MR) and the cloud server.
You will not be able to see the traffic being sent and received on the 
distribution system, as the packets are encrypted.&lt;/p&gt;
&lt;!-- exchange UML --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="meraki cloud auth exchange diagram" src="https://castogio.github.io/images/meraki_auth_troubleshooting/meraki_auth_exchange.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;You can perform a monitor mode packet capture to EAP traffic over the air.
The following exchange can be seen:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;There is Identity Request/Response exchange where the client sends 
   the username in clear text (we will not be so lucky with the password).&lt;/li&gt;
&lt;li&gt;The authentication server sends an MD5 request.&lt;/li&gt;
&lt;li&gt;The client rejects it with a Negative Acknowledgement (NAK) and requests
   to use Protected EAP (PEAP).&lt;/li&gt;
&lt;li&gt;The server agrees to use PEAP/EAP-TLS.&lt;/li&gt;
&lt;li&gt;The client and the server perform the encrypted EAP protocol exchanges.&lt;/li&gt;
&lt;li&gt;The server sends an EAP Success message to the client.&lt;/li&gt;
&lt;li&gt;The 4-way RSN handshake can start.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;NOTE: you may notice that the client wireless MAC address is translated by
Wireshark as "Apple." This is expected as I was running Windows dual-booted
on a MacBook.&lt;/p&gt;
&lt;!-- packet capture success --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="packet capture of EAP success" src="https://castogio.github.io/images/meraki_auth_troubleshooting/SUCCESS_meraki_auth_exchange.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;You can follow the exchanges described above (and more!) in the Event Viewer,
which logs every operation and state transition performed by the 802.11 state 
machine in chronological order from bottom to top (an event lower in the list
happened before the ones on top of it) as you can see in the picture below. 
We will focus on the logs whose Task Category is &lt;em&gt;OneXAuthentication&lt;/em&gt; (i.e. 
they are associated with 802.1X). I highlighted the last 1X event, showing a 
successful authentication and specifying the correct email used as "Identity," 
here shown as "hello@correct.com" (just an example).&lt;/p&gt;
&lt;!-- log success --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="EAP log success on Windows" src="https://castogio.github.io/images/meraki_auth_troubleshooting/capture_success_windows.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;h2&gt;Dissecting a failed authentication&lt;/h2&gt;
&lt;p&gt;Despite what we have seen in the previous section, the operation may not
be very smooth when your user report issues with "connecting with the Wi-Fi".
You may not have immediate access to your trusty sidekick
or a different client to collect monitor mode capture. Nonetheless, you can
still open the Event Viewer, ask the user to attempt a connection, see if fail
miserably, and review what is being reported in the logs.&lt;/p&gt;
&lt;!-- log failure --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="EAP log failure on Windows" src="https://castogio.github.io/images/meraki_auth_troubleshooting/capture_FAILURE_windows.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The general structure of the reports, as you can see above, did not change much
from the &lt;em&gt;successful&lt;/em&gt; case. In particular, we can see that the client 
passed the Open Authentication and the Association phases, but it stalled
when attempting the 802.1X operation.&lt;/p&gt;
&lt;p&gt;Opening the log in question (helpfully marked as an "Error"), we can see that
WLAN-AutoConfig reports the fact that this was an &lt;em&gt;explicit&lt;/em&gt; EAP authentication
failure and that we sent the identity "HELLO@correct.com" (which we know is 
incorrect, as seen previously).&lt;/p&gt;
&lt;p&gt;Being in my laboratory, I could take the packet capture and indeed all the EAP 
exchanges seen previously show up again, with the sole exception of the last
frame which contains an EAP failure message (matching what was reported in the
Event Viewer).&lt;/p&gt;
&lt;!-- packet capture failure --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="packet capture of EAP failure" src="https://castogio.github.io/images/meraki_auth_troubleshooting/FAIL_meraki_auth_exchange.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Having been burnt in the past, I would recommend you cross-check and confirm the
reports from any facility using some additional external tools. In the scenario
described in this post, the Event Viewer correctly pointed to the root cause, 
but it might not be direct when it comes to more complex problems (also, bugs
are a thing). Seeing an EAP failure in the packet capture confirmed the fact.  &lt;/p&gt;
&lt;h2&gt;Conclusion and Lesson Learned&lt;/h2&gt;
&lt;p&gt;The main takeaway of this little demo is "&lt;em&gt;know your tools&lt;/em&gt;".
Client devices offer a multitude of built-in programs that will immensely 
simplify your day-to-day as a wireless analyst, especially when you do not 
have access to more sophisticated equipment. The Event Viewer is the perfect 
example of a tool that ships with Windows and can show you what the client
is doing, what &lt;strong&gt;it believes&lt;/strong&gt; is going wrong, and, potentially, how to 
remediate the issue, as in our case.&lt;/p&gt;
&lt;h3&gt;Bibliography&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;“Managing User Accounts Using Meraki Cloud Authentication.” 
   Cisco Meraki, Feb. 2023, https://bit.ly/3UQh38T. Accessed 25 Apr. 2023.&lt;/li&gt;
&lt;li&gt;"Event Viewer." Microsoft, 
   Jan. 2019, https://bit.ly/41SfPMC. Accessed 26 Apr. 2023.&lt;/li&gt;
&lt;/ul&gt;</content><category term="802.11"></category></entry><entry><title>Demystifying modulation techniques with BPSK</title><link href="https://castogio.github.io/demystifying-modulation-techniques-with-bpsk.html" rel="alternate"></link><published>2023-04-18T22:11:00+01:00</published><updated>2023-04-18T22:11:00+01:00</updated><author><name>Gioacchino Castorio</name></author><id>tag:castogio.github.io,2023-04-18:/demystifying-modulation-techniques-with-bpsk.html</id><summary type="html">&lt;p&gt;The multitude of Modulation and Coding Schemes (MCSs) 
introduced in IEEE802.11 for the VHT and HE PHYs may look like magical 
spells even for the seasoned wireless engineer. At the start of my journey 
as a telecommunications engineer, I was particularly
fascinated by the mathematics behind how to carry …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The multitude of Modulation and Coding Schemes (MCSs) 
introduced in IEEE802.11 for the VHT and HE PHYs may look like magical 
spells even for the seasoned wireless engineer. At the start of my journey 
as a telecommunications engineer, I was particularly
fascinated by the mathematics behind how to carry information from a transmitter
(TX) to a receiver (RX). I believe it might be worth it to take a step back
and get a mathematical intuition of what is happening behind the scenes when 
a STA interacts with the wireless medium.&lt;/p&gt;
&lt;p&gt;Assuming we can transmit the signal wave &lt;em&gt;s(t)&lt;/em&gt;, as in the equation below, where
A is the amplitude, f is the signal frequency, and the time, we could consider
representing 1's as &lt;em&gt;s(t)&lt;/em&gt; and 0's as &lt;em&gt;-s(t)&lt;/em&gt;. &lt;/p&gt;
&lt;!-- s(t) = A*cos(2*pi*f*t) --&gt;
&lt;!-- https://latex.codecogs.com/eqneditor/editor.php --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="Simple cosine signal" src="https://castogio.github.io/images/cosine_base_signal.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The receiver station would immediately recognise what value we are transmitting 
by comparing what is received with the reference signal,
which is assumed to be known. 
The figure below shows the comparison between the reference signal and what can 
be seen at the receiving station, considering path loss exclusively and ignoring
additional effects such as multipath; the picture shows a one being received,
followed by a zero.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="periodic" src="https://castogio.github.io/images/bpsk_periodic_zero_received_vs_reference.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The carrier signal s(t) is not enough to transmit any meaningful
information in real life: the time variable t is an infinite
&lt;a href="https://en.wikipedia.org/wiki/Real_number"&gt;real number&lt;/a&gt; and s(t) repeats
periodically with no start or end in time. We are busy people and we want
to transmit more than one bit in perpetuity, so we can define a new rectangular
function &lt;em&gt;p(t)&lt;/em&gt; which is not-null only for &lt;em&gt;0 &amp;lt;= t &amp;lt;= T&lt;/em&gt;, where &lt;em&gt;T = 1/f&lt;/em&gt; is the
"period" of the signal s(t). &lt;/p&gt;
&lt;!-- 
p(t) =\begin{cases}
      1~if~0 \leq t \leq T\\
      0~otherwise
\end{cases}
--&gt;
&lt;!-- https://latex.codecogs.com/eqneditor/editor.php --&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="rectangular function" src="https://castogio.github.io/images/rect_function.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Multiplying the two functions &lt;em&gt;g(t) = s(t)p(t)&lt;/em&gt;, we get a limited section of the
original signal, namely a cycle of the cosine wave.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="Windowed cosine" src="https://castogio.github.io/images/windowed_signal.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;This signal p(t) is extremely powerful because it lets us move its "windowing" 
effect by simply shifting its "up" value by the period T to the left or right
over the time axis so that p(t-kT) = 1 for kT &amp;lt;= t &amp;lt;= (k+1)T, where k is any
&lt;a href="https://en.wikipedia.org/wiki/Integer"&gt;integer number&lt;/a&gt;. We can shift the
pulse &lt;em&gt;g(t)&lt;/em&gt; by &lt;em&gt;kT&lt;/em&gt; as well.&lt;/p&gt;
&lt;p&gt;The windowed signals can be juxtaposed to represent a sequence of 0's and 1's
fairly easily as the entire signal can be described mathematically as a
summation &lt;em&gt;S(t)&lt;/em&gt;, where N is the number of windows and the coefficient
&lt;em&gt;c&lt;/em&gt; is 1 when transmitting a "one" bit, -1 otherwise.&lt;/p&gt;
&lt;!-- 
S(t) = \sum_{k=0}^{N-1} c_k*g(t-kT) = \sum_{k=0}^{N-1} c_k*s(t-kT)*p(t-kT)
--&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="pulse train formula" src="https://castogio.github.io/images/pulse_train_formula.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The following image shows an example of the application of the above formula
when transmitting a zero followed by a one; the receiver can compare its
local reference to the received signal. Note that this example
considers the existence of some attenuation at RX due to Free Space Path Loss
while ignoring other detrimental effects such as multi-path.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="pulse train plot" src="https://castogio.github.io/images/bpsk_received_vs_reference.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;You might have noticed that some level of time synchronisation is
needed between the reference and the received signal to allow effective
demodulation. This fact is true regardless of the modulation technique in use,
and it intuitively justifies the existence of preamble sequences in the 
IEEE802.11 PHY Protocol Data Units (PPDUs).&lt;/p&gt;
&lt;p&gt;In conclusion, we managed to transmit a sequence of single bits leveraging the 
simple fact that our RX can discriminate between a positive 
or a negative coefficient for the signal. 
We defined a signal constellation containing two pints which are shifted
180 degrees between each other: this technique is commonly referred to as
Binary Phase Shift Keying (BPSK) because the same base carrier &lt;em&gt;s(t)&lt;/em&gt; can 
assume two different phase configurations to represent a single bit.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;
    &lt;img alt="pulse train plot" src="https://castogio.github.io/images/bpsk_constellation.png"&gt;
&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Intuitively, we can expand the number of transmitted bits by following the same
principles of "tweak a parameter and compare to a reference" as described above.
We will explore Amplitude Shift Keying (ASK), Quadrature Phase Shift Keying
(QPSK), and Quadrature Amplitude Modulation (QAM) in future blog posts.&lt;/p&gt;
&lt;p&gt;Until next time!&lt;/p&gt;
&lt;h3&gt;Bibliography&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Moher, Michael, and S. Haykin. Communication Systems, 5th ed, Chapter 4. 
  Wiley, 2010.&lt;/li&gt;
&lt;li&gt;Carpenter, T. CWAP-404: Certified Wireless Analysis Professional, Chapter 3. 
  Certitrek Publishing, 2021&lt;/li&gt;
&lt;/ul&gt;</content><category term="802.11"></category></entry></feed>